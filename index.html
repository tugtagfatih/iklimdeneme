<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ã‡evre Ayak Ä°zi HesaplayÄ±cÄ±</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        /* CSS stilleri Ã¶ncekiyle aynÄ±, bu alanÄ± deÄŸiÅŸtirmeye gerek yok */
        body{font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Helvetica,Arial,sans-serif;background-color:#f4f7f6;color:#333;margin:0;padding:20px;display:flex;justify-content:center}.container{max-width:800px;width:100%;background-color:#fff;padding:20px 40px;border-radius:10px;box-shadow:0 4px 15px rgba(0,0,0,.1)}h1{text-align:center;color:#2c3e50}.tabs{display:flex;justify-content:center;flex-wrap:wrap;margin-bottom:20px;border-bottom:2px solid #e0e0e0}.tab-button{padding:10px 15px;cursor:pointer;border:none;background-color:transparent;font-size:1em;color:#7f8c8d;border-bottom:3px solid transparent;transition:all .3s ease}.tab-button:hover{color:#3498db}.tab-button.active{color:#2980b9;border-bottom:3px solid #2980b9}.content-panel{display:none}.content-panel.active{display:block}.form-group{margin-bottom:15px}label{display:block;margin-bottom:5px;font-weight:700;color:#555}input[type=number],input[type=text]{width:100px;padding:8px;border:1px solid #ccc;border-radius:4px;box-sizing:border-box}.question-block{background-color:#f9f9f9;padding:15px;border-radius:5px;margin-bottom:15px;border-left:4px solid #3498db}.question-block p{font-weight:700;margin:0 0 10px}.question-block label{font-weight:400;display:block;margin-bottom:5px}.calc-button{display:block;width:100%;padding:12px;background-color:#27ae60;color:#fff;border:none;border-radius:5px;font-size:1.2em;cursor:pointer;margin-top:20px;transition:background-color .3s ease}.calc-button:hover{background-color:#229954}.result-area{margin-top:25px;padding:15px;border-radius:5px;background-color:#ecf0f1;text-align:center}.placeholder-content{text-align:center;padding:50px 20px;font-size:1.5em;color:#95a5a6}.chart-container{display:flex;flex-wrap:wrap;justify-content:space-around;gap:20px;margin-top:20px}.chart-box{width:100%;max-width:350px}
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸŒ Ã‡evre Ayak Ä°zi HesaplayÄ±cÄ±</h1>
        <div class="tabs">
            <button class="tab-button active" onclick="showPanel('water')">ğŸ’§ Su Ayak Ä°zi</button>
            <button class="tab-button" onclick="showPanel('carbon')">ğŸ’¨ Karbon Ayak Ä°zi</button>
            <button class="tab-button" onclick="showPanel('averages')">ğŸ“Š Genel Ortalamalar</button>
            <button class="tab-button" onclick="showPanel('myths')">â“ DoÄŸru Bilinen YanlÄ±ÅŸlar</button>
            <button class="tab-button" onclick="showPanel('chatbot')">ğŸ¤– Chatbot</button>
        </div>

        <div id="waterPanel" class="content-panel active">
             </div>

        <div id="carbonPanel" class="content-panel">
            </div>
        
        <div id="averagesPanel" class="content-panel">
            <div id="averagesResult" class="result-area">
                </div>
             <div class="chart-container">
                <div class="chart-box"><canvas id="averagesChart"></canvas></div>
            </div>
        </div>
        
        <div id="mythsPanel" class="content-panel"></div>
        <div id="chatbotPanel" class="content-panel"></div>
    </div>

<script>
// ---------- Ã–nceki JS kodunun tamamÄ±nÄ± bu yeni kodla deÄŸiÅŸtirin ----------

// ---------- Genel Fonksiyonlar ----------
document.addEventListener('DOMContentLoaded', () => {
    // HTML'in ilgili bÃ¶lÃ¼mlerini doldurmak iÃ§in bu fonksiyonlarÄ± Ã§aÄŸÄ±rÄ±n
    const waterForm = document.getElementById('waterPanel');
    if (waterForm) {
        waterForm.innerHTML = `
            <form id="waterForm">
                <p>LÃ¼tfen aÅŸaÄŸÄ±daki sorularÄ± gÃ¼nlÃ¼k tÃ¼ketim miktarlarÄ±nÄ±za gÃ¶re cevaplayÄ±nÄ±z.</p>
            </form>
            <button type="button" class="calc-button" onclick="calculateWaterFootprint()">Hesapla ve Sunucuya Kaydet</button>
            <div id="waterResult" class="result-area" style="display:none;">
                <p id="server-response" style="font-weight:bold;"></p>
                <p id="waterTotalText"></p>
                <p id="waterAdviceText"></p>
                <div class="chart-container">
                    <div class="chart-box"><canvas id="categoryChart"></canvas></div>
                    <div class="chart-box"><canvas id="waterTypeChart"></canvas></div>
                </div>
            </div>`;
        populateWaterQuestions();
    }
    const carbonForm = document.getElementById('carbonPanel');
    if(carbonForm) {
        carbonForm.innerHTML = `
            <form id="carbonForm">
                <p>LÃ¼tfen aÅŸaÄŸÄ±daki 10 soruyu cevaplayÄ±n.</p>
            </form>
            <button type="button" class="calc-button" onclick="calculateCarbonFootprint()">Hesapla</button>
            <div id="carbonResult" class="result-area" style="display:none;"></div>`;
        populateCarbonQuestions();
    }
    const mythsPanel = document.getElementById('mythsPanel');
    if(mythsPanel) mythsPanel.innerHTML = `<div class="placeholder-content">YakÄ±nda Burada...</div>`;

    const chatbotPanel = document.getElementById('chatbotPanel');
    if(chatbotPanel) chatbotPanel.innerHTML = `<div class="placeholder-content">YakÄ±nda Burada...</div>`;
});

function showPanel(panelName) {
    document.querySelectorAll('.content-panel').forEach(p => p.classList.remove('active'));
    document.querySelectorAll('.tab-button').forEach(b => b.classList.remove('active'));

    document.getElementById(panelName + 'Panel').classList.add('active');
    document.querySelector(`.tab-button[onclick*="'${panelName}'"]`).classList.add('active');

    // Ortalama sekmesine tÄ±klandÄ±ÄŸÄ±nda sunucudan veriyi Ã§ek
    if (panelName === 'averages') {
        fetchAverageResults();
    }
}


// ---------- Su Ayak Ä°zi BÃ¶lÃ¼mÃ¼ ----------
const water_questions = [
    { text: "1) GÃ¼nde kaÃ§ litre iÃ§me suyu tÃ¼ketiyorsunuz?", factor: 0.001, water_type: "blue", category: "household" },
    { text: "2) GÃ¼nde kaÃ§ dakika duÅŸ alÄ±yorsunuz?", factor: 0.0095, water_type: "blue", category: "household" },
    { text: "3) GÃ¼nde kaÃ§ kez sifon Ã§ekiyorsunuz?", factor: 0.006, water_type: "gray", category: "household" },
    { text: "4) GÃ¼nde kaÃ§ kilogram Ã§amaÅŸÄ±r yÄ±kÄ±yorsunuz?", factor: 0.015, water_type: "blue", category: "household" },
    { text: "5) GÃ¼nde kaÃ§ kez bulaÅŸÄ±k yÄ±kÄ±yorsunuz (elde/makinede)?", factor: 0.01, water_type: "gray", category: "household" },
    { text: "6) GÃ¼nde kaÃ§ fincan Ã§ay/kahve iÃ§iyorsunuz?", factor: 0.05, water_type: "green", category: "food" },
    { text: "7) GÃ¼nde kaÃ§ kilogram et tÃ¼ketiyorsunuz?", factor: 15.0, water_type: "green", category: "food" },
    { text: "8) GÃ¼nde kaÃ§ kilogram sÃ¼t Ã¼rÃ¼nÃ¼ tÃ¼ketiyorsunuz?", factor: 1.0, water_type: "green", category: "food" },
    { text: "9) GÃ¼nde kaÃ§ kilogram meyve tÃ¼ketiyorsunuz?", factor: 0.9, water_type: "green", category: "food" },
    { text: "10) GÃ¼nde kaÃ§ kilogram sebze tÃ¼ketiyorsunuz?", factor: 0.2, water_type: "green", category: "food" },
    { text: "11) GÃ¼nde kaÃ§ kilogram ekmek/tahÄ±l tÃ¼ketiyorsunuz?", factor: 1.3, water_type: "green", category: "food" },
    { text: "12) GÃ¼nde kaÃ§ adet yumurta tÃ¼ketiyorsunuz?", factor: 0.2, water_type: "green", category: "food" },
    { text: "13) GÃ¼nde kaÃ§ litre paketli iÃ§ecek (kola vb.) tÃ¼ketiyorsunuz?", factor: 0.002, water_type: "gray", category: "others" },
    { text: "14) GÃ¼nde kaÃ§ litre bahÃ§e/saksÄ± sulama suyu kullanÄ±yorsunuz?", factor: 0.001, water_type: "blue", category: "others" },
    { text: "15) GÃ¼nde kaÃ§ kilometre Ã¶zel aracÄ±nÄ±zÄ± kullanÄ±yorsunuz?", factor: 0.0007, water_type: "gray", category: "others" },
    { text: "16) GÃ¼nde kaÃ§ kilometre toplu taÅŸÄ±ma kullanÄ±yorsunuz?", factor: 0.0002, water_type: "gray", category: "others" },
    { text: "17) Ayda kaÃ§ adet giysi/ayakkabÄ± satÄ±n alÄ±yorsunuz? (LÃ¼tfen aylÄ±k adedi girin)", factor: 0.1, water_type: "green", category: "others" },
    { text: "18) GÃ¼nde kaÃ§ saat elektronik cihaz (bilgisayar, TV vb.) kullanÄ±yorsunuz?", factor: 0.001, water_type: "gray", category: "others" },
    { text: "19) GÃ¼nde kaÃ§ sayfa kaÄŸÄ±t kullanÄ±yorsunuz?", factor: 0.005, water_type: "gray", category: "others" },
    { text: "20) GÃ¼nde kaÃ§ kilogram gÄ±da israf ediyorsunuz?", factor: 1.0, water_type: "gray", category: "food" },
    { text: "21) GÃ¼nde kaÃ§ litre temizlik malzemesi (deterjan vb.) kullanÄ±yorsunuz?", factor: 0.001, water_type: "gray", category: "household" },
    { text: "22) GÃ¼nde kaÃ§ litre bitkisel sÃ¼t (soya, badem vb.) tÃ¼ketiyorsunuz?", factor: 0.2, water_type: "blue", category: "food" },
    { text: "23) GÃ¼nde kaÃ§ saat klimalÄ±/Ä±sÄ±tmalÄ± odalarda vakit geÃ§iriyorsunuz?", factor: 0.0004, water_type: "gray", category: "household" },
    { text: "24) GÃ¼nde kaÃ§ adet plastik ÅŸiÅŸe kullanÄ±yorsunuz?", factor: 0.003, water_type: "gray", category: "others" },
    { text: "25) GÃ¼nde kaÃ§ adet atÄ±ÅŸtÄ±rmalÄ±k paketi (cips vb.) tÃ¼ketiyorsunuz?", factor: 0.15, water_type: "gray", category: "food" }
];
let categoryChartInstance, waterTypeChartInstance, averagesChartInstance;

function populateWaterQuestions() {
    const form = document.getElementById('waterForm');
    water_questions.forEach((q, index) => {
        const id = `water_q${index + 1}`;
        const formGroup = document.createElement('div');
        formGroup.className = 'form-group';
        formGroup.innerHTML = `<label for="${id}">${q.text}</label><input type="number" id="${id}" name="${id}" min="0" step="any" placeholder="0">`;
        form.appendChild(formGroup);
    });
}

function calculateWaterFootprint() {
    const footprint = { household: 0.0, food: 0.0, others: 0.0, blue: 0.0, green: 0.0, gray: 0.0 };
    water_questions.forEach((q, index) => {
        const id = `water_q${index + 1}`;
        const answer = parseFloat(document.getElementById(id).value) || 0.0;
        const value_m3 = answer * q.factor;
        footprint[q.category] += value_m3;
        footprint[q.water_type] += value_m3;
    });
    const total_footprint = footprint.household + footprint.food + footprint.others;
    footprint.total = total_footprint;
    document.getElementById('waterTotalText').innerText = `ğŸ’§ GÃ¼nlÃ¼k toplam su ayak iziniz: ${total_footprint.toFixed(3)} mÂ³ (yani ${(total_footprint * 1000).toFixed(0)} Litre)`;
    let advice = '';
    if (total_footprint < 2) advice = "Harika! Su ayak iziniz oldukÃ§a dÃ¼ÅŸÃ¼k. ğŸ‘";
    else if (total_footprint < 4) advice = "Normal. Su ayak iziniz dÃ¼nya ortalamasÄ±na yakÄ±n. ğŸ‘";
    else advice = "YÃ¼ksek! Su ayak iziniz ortalamanÄ±n Ã¼zerinde. ğŸ˜Ÿ";
    document.getElementById('waterAdviceText').innerHTML = advice;
    drawWaterCharts(footprint);
    document.getElementById('waterResult').style.display = 'block';
    sendDataToServer(footprint);
}

async function sendDataToServer(data) {
    const serverResponseElement = document.getElementById('server-response');
    serverResponseElement.textContent = 'SonuÃ§lar kaydediliyor...';
    serverResponseElement.style.color = 'orange';
    try {
        const response = await fetch('save_data.php', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(data),
        });
        const result = await response.json();
        if (response.ok && result.status === 'success') {
            serverResponseElement.textContent = 'âœ… SonuÃ§larÄ±nÄ±z sunucuya baÅŸarÄ±yla kaydedildi!';
            serverResponseElement.style.color = 'green';
        } else {
            throw new Error(result.message || 'Sunucuya kaydederken bir hata oluÅŸtu.');
        }
    } catch (error) {
        console.error('Sunucuya gÃ¶nderme hatasÄ±:', error);
        serverResponseElement.textContent = `âŒ KayÄ±t baÅŸarÄ±sÄ±z: ${error.message}`;
        serverResponseElement.style.color = 'red';
    }
}

function drawWaterCharts(footprint) {
    if (categoryChartInstance) categoryChartInstance.destroy();
    if (waterTypeChartInstance) waterTypeChartInstance.destroy();
    const categoryCtx = document.getElementById('categoryChart').getContext('2d');
    categoryChartInstance = new Chart(categoryCtx, {
        type: 'bar', data: { labels: ['Evsel', 'GÄ±da', 'DiÄŸer'], datasets: [{ data: [footprint.household, footprint.food, footprint.others], backgroundColor: ['#3498db', '#2ecc71', '#95a5a6'] }] },
        options: { responsive: true, plugins: { legend: { display: false }, title: { display: true, text: 'Kategoriye GÃ¶re Ayak Ä°zi (mÂ³)' } }, scales: { y: { beginAtZero: true } } }
    });
    const waterTypeCtx = document.getElementById('waterTypeChart').getContext('2d');
    waterTypeChartInstance = new Chart(waterTypeCtx, {
        type: 'bar', data: { labels: ['Mavi Su', 'YeÅŸil Su', 'Gri Su'], datasets: [{ data: [footprint.blue, footprint.green, footprint.gray], backgroundColor: ['#3498db', '#2ecc71', '#95a5a6'] }] },
        options: { responsive: true, plugins: { legend: { display: false }, title: { display: true, text: 'Su Tipine GÃ¶re Ayak Ä°zi (mÂ³)' } }, scales: { y: { beginAtZero: true } } }
    });
}

// ---------- Genel Ortalamalar BÃ¶lÃ¼mÃ¼ ----------
async function fetchAverageResults() {
    const resultDiv = document.getElementById('averagesResult');
    const chartCanvas = document.getElementById('averagesChart');
    resultDiv.innerHTML = "<h3>Genel Ortalamalar</h3><p>Ortalamalar sunucudan yÃ¼kleniyor...</p>";
    chartCanvas.style.display = 'none';
    if(averagesChartInstance) averagesChartInstance.destroy();

    try {
        const response = await fetch('get_averages.php');
        const data = await response.json();

        if (data.status === 'success') {
            const averages = data.averages;
            resultDiv.innerHTML = `
                <h3>TÃ¼m KullanÄ±cÄ±larÄ±n Genel OrtalamalarÄ± (${data.record_count} kayÄ±t Ã¼zerinden)</h3>
                <p><strong>Ortalama Toplam Ayak Ä°zi: ${averages.total.toFixed(3)} mÂ³/gÃ¼n</strong></p>
                <p>Ortalama Evsel TÃ¼ketim: ${averages.household.toFixed(3)} mÂ³/gÃ¼n</p>
                <p>Ortalama GÄ±da TÃ¼ketimi: ${averages.food.toFixed(3)} mÂ³/gÃ¼n</p>
                <p>Ortalama DiÄŸer TÃ¼ketimler: ${averages.others.toFixed(3)} mÂ³/gÃ¼n</p>
            `;
            chartCanvas.style.display = 'block';
            drawAveragesChart(averages);
        } else {
             resultDiv.innerHTML = `<h3>Genel Ortalamalar</h3><p>${data.message}</p>`;
        }
    } catch (error) {
        console.error('Ortalama verisi alÄ±namadÄ±:', error);
        resultDiv.innerHTML = '<h3>Hata</h3><p>Ortalama verileri sunucudan alÄ±nÄ±rken bir sorun oluÅŸtu.</p>';
    }
}

function drawAveragesChart(averages) {
    if (averagesChartInstance) averagesChartInstance.destroy();
    const averagesCtx = document.getElementById('averagesChart').getContext('2d');
    averagesChartInstance = new Chart(averagesCtx, {
        type: 'doughnut',
        data: {
            labels: ['Evsel TÃ¼ketim', 'GÄ±da TÃ¼ketimi', 'DiÄŸer TÃ¼ketimler'],
            datasets: [{
                label: 'Ortalama DaÄŸÄ±lÄ±m',
                data: [averages.household, averages.food, averages.others],
                backgroundColor: ['#3498db', '#2ecc71', '#95a5a6'],
                hoverOffset: 4
            }]
        },
        options: { responsive: true, plugins: { title: { display: true, text: 'Genel Ortalama TÃ¼ketim DaÄŸÄ±lÄ±mÄ±' } } }
    });
}

// ---------- Karbon Ayak Ä°zi BÃ¶lÃ¼mÃ¼ ----------
const carbon_questions = [
    { soru: "1. GÃ¼nlÃ¼k ulaÅŸÄ±m tercihiniz nedir?", secenekler: { a: ["YÃ¼rÃ¼yÃ¼ÅŸ / Bisiklet", 0], b: ["Toplu taÅŸÄ±ma", 2], c: ["Ã–zel araÃ§", 4] } },
    { soru: "2. Haftada kaÃ§ gÃ¼n et tÃ¼ketirsiniz?", secenekler: { a: ["HiÃ§", 0], b: ["1-3 gÃ¼n", 2], c: ["4 gÃ¼n ve Ã¼zeri", 4] } },
    { soru: "3. Evinizde enerji tasarruflu ampuller kullanÄ±yor musunuz?", secenekler: { a: ["Evet", 0], b: ["BazÄ±larÄ±", 2], c: ["HayÄ±r", 4] } },
    { soru: "4. Geri dÃ¶nÃ¼ÅŸÃ¼m yapÄ±yor musunuz?", secenekler: { a: ["Evet, dÃ¼zenli olarak", 0], b: ["Ara sÄ±ra", 2], c: ["HiÃ§", 4] } },
    { soru: "5. Tatil iÃ§in yÄ±lda kaÃ§ kez uÃ§aÄŸa biniyorsunuz?", secenekler: { a: ["HiÃ§", 0], b: ["1-2 kez", 3], c: ["3 kez ve Ã¼zeri", 5] } },
    { soru: "6. Evinizde enerji verimli cihazlar kullanÄ±yor musunuz (A++ vb)?", secenekler: { a: ["Evet", 0], b: ["BazÄ±larÄ±", 2], c: ["HayÄ±r", 4] } },
    { soru: "7. Su tasarrufu saÄŸlamak iÃ§in Ã¶nlem alÄ±yor musunuz?", secenekler: { a: ["Evet", 0], b: ["Bazen", 2], c: ["HayÄ±r", 4] } },
    { soru: "8. Elektronik cihazlarÄ± kullanÄ±lmadÄ±ÄŸÄ±nda kapatÄ±yor musunuz?", secenekler: { a: ["Evet", 0], b: ["Bazen", 2], c: ["HayÄ±r", 4] } },
    { soru: "9. Ä°kinci el Ã¼rÃ¼nler alÄ±r mÄ±sÄ±nÄ±z?", secenekler: { a: ["Evet, sÄ±k sÄ±k", 0], b: ["Ara sÄ±ra", 2], c: ["HayÄ±r", 4] } },
    { soru: "10. Plastik kullanÄ±mÄ±nÄ± azaltmak iÃ§in Ã§aba harcar mÄ±sÄ±nÄ±z?", secenekler: { a: ["Evet", 0], b: ["Bazen", 2], c: ["HayÄ±r", 4] } }
];

function populateCarbonQuestions() {
    const form = document.getElementById('carbonForm');
    carbon_questions.forEach((q, index) => {
        const q_name = `carbon_q${index + 1}`;
        let optionsHTML = '';
        for (const [key, value] of Object.entries(q.secenekler)) {
            const [text, score] = value;
            optionsHTML += `<label><input type="radio" name="${q_name}" value="${score}" required> ${text}</label>`;
        }
        const questionBlock = document.createElement('div');
        questionBlock.className = 'question-block';
        questionBlock.innerHTML = `<p>${q.soru}</p>${optionsHTML}`;
        form.appendChild(questionBlock);
    });
}

function calculateCarbonFootprint() {
    const form = document.getElementById('carbonForm');
    if (!form.checkValidity()) {
        alert("LÃ¼tfen tÃ¼m sorularÄ± cevaplayÄ±nÄ±z.");
        return;
    }
    let score = 0;
    for (let i = 1; i <= carbon_questions.length; i++) {
        score += parseInt(document.querySelector(`input[name="carbon_q${i}"]:checked`).value);
    }
    const resultDiv = document.getElementById('carbonResult');
    let resultHTML = "<h3>ğŸ” Karbon Ayak Ä°zi Sonucunuz</h3>";
    if (score <= 10) resultHTML += "<p>âœ… Tebrikler! Karbon ayak iziniz oldukÃ§a dÃ¼ÅŸÃ¼k.</p>";
    else if (score <= 25) resultHTML += "<p>âš ï¸ Orta seviyede bir karbon ayak iziniz var.</p>";
    else resultHTML += "<p>âŒ Karbon ayak iziniz yÃ¼ksek!</p>";
    resultDiv.innerHTML = resultHTML;
    resultDiv.style.display = 'block';
}
</script>

</body>
</html>
